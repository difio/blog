
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us" xml:lang="en-us" xmlns:fb="https://www.facebook.com/2008/fbml" id="html-main">
<head>
  <title>How to write a registration agent for Difio - Difio</title>
  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <link rel="canonical" href="http://dif.io/blog/2012/02/11/how-to-write-registration-agent-for-difio" />
  <link href="/blog/favicon.png" rel="icon" />
  <script src="/blog/javascripts/modernizr-2.0.js" type="text/javascript"></script>
  <script src="/blog/javascripts/ender.js" type="text/javascript"></script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/blog/atom.xml" rel="alternate" title="Difio" type="application/atom+xml" />
  <!-- OpenGraph -->
<meta property="og:image" content="//d3h3t4beeg8ypi.cloudfront.net/static/v6/i/72.png" />
<meta property="og:title" content="How to write a registration agent for Difio" />
<meta property="og:site_name" content="Difio" />

<link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css' />
<link type="text/css" rel="stylesheet" media="screen" href="//d3h3t4beeg8ypi.cloudfront.net/static/v17/css/style.css" />
<link href="/blog/stylesheets/fonts.css" media="screen, projection" rel="stylesheet" type="text/css" />
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-33303431-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
    <div id="subheader">
    <div class="toplevel">
        <h1><a href="/blog/" class="logo">difio</a><sub>blog</sub></h1>
            <div class="navigation">
        <div class="signin"><a href="/blog/archives"  class="button light_blue small">Blog Archives</a></div>
        <div class="signin">&nbsp;&nbsp;</div>
        <div class="signin"><a href="http://www.dif.io/register/" class="button light_blue small">Register Apps</a></div>
    </div>


    </div>
</div> <!-- END subheader -->
<div id="buffer"></div>



    <div id="content">
        <div class="toplevel">
            <div style="float: left; width: 100%">
                    
        
            <h2>How to Write a Registration Agent for Difio</h2>
        
    

        
        

        
            
  

<span class="byline author vcard">Posted by <span class="fn">Difio Team</span></span>
@
            








  Feb 11<span>th</span>, 2012



            <br /><br />
        
    

    
            <div class="entry-content"><p><a href="http://www.dif.io">Difio</a> is aiming to support a broad range of PaaS and
cloud vendors but that takes time. If your favorite PaaS platform is not
already supported here&#8217;s how you can help.</p>

<p>The registration agent is very simple and serves only a single purpose -
to build a list of installed software and send it to the server.</p>

<p>Some general considerations first:</p>

<ul>
<li><p>Your code should be open source! Preferably licensed under the MIT or BSD license;</p></li>
<li><p>Whenever possible use the native programming language for the platform - if writing
an agent for PHP PaaS use PHP, if writing for Node.JS use JavaScript, etc;</p></li>
<li><p>All registration agents are bundled as packages so that they can install natively
on the platform. For Python it is a package from PyPI, for PHP it will be a PEAR package,
etc. Develop your agent as a package;</p></li>
<li><p>Naming convention for registration agent is <strong>difio-&lt;vendor>-&lt;language></strong>. For example
<code>difio-openshift-python</code>, <code>difio-dotcloud-nodejs</code>. If you have common code,
for example the package management part, it can be split into separate module named
<strong>common-&lt;language>-difio</strong>.</p></li>
<li><p>Registration agents are specific to vendor and programming language. This is because
different PaaS vendors provide the information in a different way. This makes code easier
to maintain and easier for end-users to find the proper registration agent later;</p></li>
<li><p>Vendor ID and package type ID numbers are unique. It is important to use the correct IDs.
They allow proper identification of applications and packages stored in the database.
Different types of data also require different processing. Tell us for which vendor/language
you would like to contribute a registration agent and we will reserve the IDs for you;</p></li>
<li><p>We will also setup a development server so you can safely test the application
registration/update process. Just let us know you need one.</p></li>
</ul>


<p>Once you have the ID allocation and development server you can start writing some code.</p>

<ul>
<li><p>Your code should create the following data structure:</p>

<pre><code>  {
      'user_id'    : integer,
      'app_name'   : string,
      'app_uuid'   : string,
      'app_type'   : string,
      'app_url'    : string,
      'app_vendor' : integer,
      'pkg_type'   : integer,
      'installed'  : list of {'n' : string, 'v' : string, 't' : integer}
  }
</code></pre></li>
</ul>


<p>Fields are defined as follow:</p>

<ul>
<li><p>user_id - integer - the ID of the user at Difio website. All applications registered under
the same user_id will be visible only to that user. You can view your UserID
<a href="https://difio-otb.rhcloud.com/profiles/mine/">here</a>. It is important that this value is not
hard-coded but read from ENV variable or a text file. The user will configure the proper
value when installing the registration agent into their application;</p></li>
<li><p>app_name - string - the name of the application. This is used to identify the application in the
web interface. The value is usually available from ENV variable;</p></li>
<li><p>app_uuid - string - a unique identifier of the application on the cloud platform. Some platforms
do not provide a real UUID. In such case you may use any unique string, for example $username-$appname;</p></li>
<li><p>app_type - string - type of the application, e.g. Python, Ruby, etc. Used for visualization in the
web interface. Some cloud vendors store this in ENV variable;</p></li>
<li><p>app_url - string - the URL at which the application can be accessed including the protocol part (http://).
Should be available from ENV;</p></li>
<li><p>app_vendor - integer - the vendor ID reserved by Difio. This is used for proper identification
of applications in the web console and for processing purposes;</p></li>
<li><p>pkg_type - integer - the package type ID reserved by Difio. This is used to properly process
package information and find new versions and updates. If the cloud platform allows only a single
type of packages to be installed into the application then use this variable. If you can install
multiple package types (e.g. Python and Ruby) then you can set this on a per-package basis;</p></li>
<li><p>installed - a list of {&#8216;n&#8217; : string, &#8216;v&#8217; : string, &#8216;t&#8217; : integer} elements, where:</p>

<ul>
<li><p>n - string - package name as identified by a native package management tool (e.g. gem, pip, etc);</p></li>
<li><p>v - string - package version;</p></li>
<li><p>t - integer (optional) - package type ID reserved by Difio. Define it here is multiple
package types are allowed and the current package is different from <code>pkg_type</code>.</p></li>
</ul>
</li>
<li><p>In some cloud platforms your application will be considered as a package and listed in the database
as well. You may use an ENV variable to ignore this name and not include it in the list;</p></li>
<li><p>The defined structure is converted into JSON format and URL escaped;</p></li>
<li><p>Assign the escaped JSON string to the <code>json_data</code> POST variable;</p></li>
<li><p>Send a POST request to https://$devel-server-url/application/register/;</p></li>
<li><p>When sending the request make sure to include a <code>User-agent</code> header. The <code>User-agent</code>
string must follow the format:</p>

<pre><code>  difio-&lt;vendor&gt;-&lt;language&gt;/&lt;version&gt;
</code></pre></li>
<li><p>If using common packages include them in the <code>User-agent</code> string as follows:</p>

<pre><code>  difio-&lt;vendor&gt;-&lt;language&gt;/&lt;version&gt; common-&lt;language&gt;-difio/&lt;version&gt;
</code></pre>

<p>For more information about <code>User-aget</code> string format click
<a href="http://en.wikipedia.org/wiki/User_agent#Format">here</a>.</p></li>
<li><p>If everything went fine you will receive a 200 status code and response in JSON format:</p>

<pre><code>  {
      'message' : string,
      'exit_code' : integer
  }
</code></pre>

<ul>
<li><p>message - holds any pass/fail messages;</p></li>
<li><p>exit_code - non 0 in case of failure.</p></li>
</ul>
</li>
<li><p>Add a README file with instructions how to install. Pay attention to end-user configuration
settings and proper execution of the tool. The best place to place a call to
the registration script is a post_deploy/post_install hook. Some cloud platforms do not offer
hooks. In this case you may want to ping us for some help.</p></li>
</ul>


<p>Congratulations! You have just written a registration agent for your favorite PaaS and
programming language. Sent us the code for review and we will add it to our GitHub channel.</p>

<p>For more details you may take a look at <a href="https://github.com/difio/difio-openshift-python">https://github.com/difio/difio-openshift-python</a>.</p>
</div>
    

    
            <br />Categories: 

<span class="categories">
  
    <a class='category' href='/blog/categories/difio/'>Difio</a>, <a class='category' href='/blog/categories/open-source/'>Open Source</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>
  
</span>


    


<div id="paging">
  <div style="display: block; border-bottom: #415469 1px dotted; margin-bottom: 15px; padding-bottom:25px;">
    
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://dif.io/blog/2012/02/11/how-to-write-registration-agent-for-difio/" data-via="DifioNews" data-counturl="http://dif.io/blog/2012/02/11/how-to-write-registration-agent-for-difio/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    

    
        <a style="float: left;" href="/blog/2012/02/10/spinning-up-a-development-instance-on-openshift-express/" title="Previous Post: Spinning-up a development instance on OpenShift Express">&laquo; Spinning-up a development instance on OpenShift Express</a>
    

    
        <a style="float: right;" href="/blog/2012/02/17/difio-1.2-release-announcement/" title="next Post: Difio 1.2 Release Announcement">Difio 1.2 Release Announcement &raquo;</a>
    
  </div>

    
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    
</div>

            </div>
        </div>

    </div> <!-- END FRONTPAGE -->

      <div id="footer">
        <div class="toplevel">
            <ul>
                <li style="margin-left:0"><a href="http://www.dif.io/register/">Register Apps</a></li>
                <li><a href="http://www.dif.io/features/">Features</a></li>
                <li><a href="http://www.dif.io/about/">About</a></li>
                <li><a href="mailto:info[at]dif.io">Contact</a></li>
                <li><a href="http://twitter.com/DifioNews">@DifioNews</a></li>
                <li><a href="https://github.com/difio/bugs/issues/new">Report bug</a></li>
            </ul>
            <div style="float: right;">&copy; 2012 difio</div>
        </div>
    </div>


  
<div id="fb-root"></div>
<script type="text/javascript">(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<script type="text/javascript">
      var disqus_shortname = 'difio';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://dif.io/blog/2012/02/11/how-to-write-registration-agent-for-difio/';
        var disqus_url = 'http://dif.io/blog/2012/02/11/how-to-write-registration-agent-for-difio/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




</body>
</html>
