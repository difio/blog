
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us" xml:lang="en-us" xmlns:fb="https://www.facebook.com/2008/fbml" id="html-main">
<head>
  <title>Blog - Monupco</title>
  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <link rel="canonical" href="http://monupco.com/blog" />
  <link href="/blog/favicon.png" rel="icon" />
  <script src="/blog/javascripts/modernizr-2.0.js" type="text/javascript"></script>
  <script src="/blog/javascripts/ender.js" type="text/javascript"></script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/blog/atom.xml" rel="alternate" title="Monupco" type="application/atom+xml" />
  <!-- OpenGraph -->
<meta property="og:image" content="//d71ktrt2emu2j.cloudfront.net/static/v1/images/logo_mo.png" />

<meta property="og:site_name" content="Monupco" />

<link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css' />
<link type="text/css" rel="stylesheet" media="screen" href="//d71ktrt2emu2j.cloudfront.net/static/v1/css/style.css" />

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28789374-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
    <div id="header">
        <div class="toplevel">
                    <ul class="global">
          <li style="margin: 5px;"><a href="/blog/archives">Archives</a></li>
<!--
          <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
-->
            <li style="margin: 5px;">&nbsp;&nbsp;</li>
            <li style="margin: 5px;">Login with</li>
            <li><a href="https://monupco-otb.rhcloud.com/login/twitter/"><img src="//d71ktrt2emu2j.cloudfront.net/static/v1/images/login/twitter.png" alt="Twitter" title="Twitter" /></a></li>
            <li><a href="https://monupco-otb.rhcloud.com/login/github/"><img src="//d71ktrt2emu2j.cloudfront.net/static/v1/images/login/github.png" alt="Github" title="Github" /></a></li>
            <li><a href="https://monupco-otb.rhcloud.com/login/facebook/"><img src="//d71ktrt2emu2j.cloudfront.net/static/v1/images/login/facebook.png" alt="Facebook" title="Facebook" /></a></li>
            <li><a href="https://monupco-otb.rhcloud.com/login/google-oauth2/"><img src="//d71ktrt2emu2j.cloudfront.net/static/v1/images/login/google-oauth2.png" alt="Google-Oauth2" title="Google-Oauth2" /></a></li>
            <li><a href="https://monupco-otb.rhcloud.com/login/linkedin/"><img src="//d71ktrt2emu2j.cloudfront.net/static/v1/images/login/linkedin.png" alt="Linkedin" title="Linkedin" /></a></li>
        </ul>


        </div>
</div> <!-- END HEADER -->


    <div id="subheader">
        <div class="toplevel">
            <h1><a href="/blog/" class="logo">monupco</a><sub>blog</sub></h1>
        </div>
    </div> <!-- END subheader -->



    <div id="content">
        <div class="toplevel">
            <div style="float: left; width: 100%">
                            
            
                
                    
        
            <h2><a href="/blog/2012/06/04/monupco-1.5-release-announcement/">Monupco 1.5 Release Announcement</a></h2>
        

        
            
  

<span class="byline author vcard">Posted by <span class="fn">Monupco Team</span></span>
@
            








  Jun 4<span>th</span>, 2012



            <br /><br />
        
    

    
        <div class="entry-content"><p>Today <a href="http://monupco.com">Monupco</a> is pleased to announce version 1.5
of our updates monitoring service. Monupco provides insight of available
updates for open source components. It lets you inspect changes and take
informed decision when or what to upgrade. This improves software life cycle
planning and minimizes possible regressions and downtime.</p>

<p>This release adds support for <a href="http://pear.php.net/">PHP PEAR</a> packages and
new registration agents for <a href="http://dotcloud.com">dotCloud</a> and
<a href="http://openshift.redhat.com">OpenShift</a> PHP applications. See
<a href="http://monupco.com/register/">how to register applications</a> page for more information.
Currently only packages from <a href="http://pear.php.net">http://pear.php.net</a> channel are supported.
We&#8217;re working on enabling additional channels like <a href="http://pecl.php.net">PECL</a>
and self hosted PEAR channels.</p>

<p>In addition to popular package index directories there are many projects which
are distributed directly and not via package index. We&#8217;ve made a first step towards
supporting such projects. This release adds support for projects which are
distributed directly from <a href="http://github.com">GitHub</a>. At the moment support is limited
to projects which use tags.</p>

<p>Our web site now supports search functionality via Google custom search.</p>

<p>In the next releases we&#8217;re going to add registration agents for more cloud/PaaS vendors
and enable manual import of packages for those who do not work in the clouds. Our team
is working on a number of website improvements to make it faster and easier to use.
In addition to that we&#8217;re also working on enabling e-mail and SMS notifications so
stay tuned!</p>

<p><a href="https://monupco-otb.rhcloud.com/applications/mine/">Give it a try</a>
or <a href="https://twitter.com/monupco">follow us</a> on Twitter for more news.</p>
</div>
        
        
    

    

            
                
                    
        
            <h2><a href="/blog/2012/05/19/cross-domain-ajax-served-from-cdn/">Cross-domain AJAX Served From CDN</a></h2>
        

        
            
  

<span class="byline author vcard">Posted by <span class="fn">Alexander Todorov</span></span>
@
            








  May 19<span>th</span>, 2012



            <br /><br />
        
    

    
        <div class="entry-content"><p>This week Amazon <a href="http://aws.typepad.com/aws/2012/05/amazon-cloudfront-support-for-dynamic-content.html">announced</a>
support for dynamic content in their CDN solution <a href="http://aws.amazon.com/cloudfront/"><em>Amazon CloudFront</em></a>.
The announce coincided with my efforts to migrate more pieces of <em>Monupco</em>&#8217;s <a href="http://monupco.com">website</a> to <em>CloudFront</em>.</p>

<p>In this article I will not talk about hosting static files on CDN. This is easy and I&#8217;ve already written
about it <a href="/blog/2012/04/17/using-openshift-as-amazon-cloudfront-origin-server/">here</a>. I will show how to
cache AJAX(JSONP actually) responses and serve them directly from <em>Amazon CloudFront</em>.</p>

<h2>Background</h2>

<p>For those if you who may not be familiar (are there any) CDN stands for
<a href="https://en.wikipedia.org/wiki/Content_delivery_network">Content Delivery Network</a>. In short
this employs numerous servers with identical content. The requests from the browser are served
from the location which gives best performance for the user. This is used by all major websites
to speed-up static content like images, video, CSS and JavaScript files.</p>

<p>AJAX means <a href="https://en.wikipedia.org/wiki/Ajax_%28programming%29">Asynchronous JavaScript and XML</a>.
This is what Google uses to create dynamic user interface which doesn&#8217;t require to reload the page.</p>

<h2>Architecture</h2>

<p><em>Monupco</em> has two web interfaces. The primary one is a static HTML website
which employs JavaScript for the dynamic areas. It is hosted on the monupco.com domain.
The other one is powered by Django and provides the same interface plus the
<a href="https://monupco-otb.rhcloud.com/applications/mine/">applications dashboard</a> and several API functions
which don&#8217;t have a visible user interface. This is under the *.rhcloud.com domain b/c it is hosted on
<a href="http://openshift.redhat.com"><em>OpenShift</em></a>.</p>

<p>The present state of the website is the result of rapid development using conventional methods -
HTML templates and server-side processing. This is migrating to modern web technology like static HTML
and JavaScript while the server side will remain pure API service.</p>

<p>For this migration to happen I need the HTML pages at monupco.com to execute JavaScript and load information
which comes from the rhcloud.com domain. Unfortunately this is not easily doable with AJAX because
of the <a href="https://en.wikipedia.org/wiki/Same_origin_policy">Same origin policy</a> in browsers.</p>

<p>I&#8217;m using the <a href="http://dojotoolkit.org/"><em>Dojo Toolkit</em></a> JavaScript framework which has a solution.
It&#8217;s called <a href="https://en.wikipedia.org/wiki/JSONP">JSONP</a>. Here&#8217;s how it works:</p>

<pre><code>    monupco.com -- JSONP request --&gt; abc.rhcloud.com --v
        ^                                              |
        |                                              |
    JavaScript processing                              |
        |                                              |
        +------------------ JSONP response ------------+
</code></pre>

<p>This is pretty standard configuration for a web service.</p>

<h2>Going to the clouds</h2>

<p>The way <em>Dojo</em> implements JSONP is through the
<a href="http://dojotoolkit.org/reference-guide/1.7/dojo/io/script.html">dojo.io.script</a> module.
It works by appending a query string parameter of the form <em>?callback=funcName</em> which the server uses
to generate the JSONP response. This callback name is dynamically generated by <em>Dojo</em> based on the order
in which your call to <em>dojo.io.script</em> is executed.</p>

<p>Until recently <em>Amazon CloudFront</em> ignored all query string parameters when requesting the content from
the origin server. Without the query string it was not possible to generate the JSONP response.
Luckily Amazon resolved the issue only one day after I asked about it on their forums.</p>

<p>Now <em>Amazon CloudFront</em> will use the URL path and the query string parameters to identify the objects in cache.
To enable this edit the CloudFront distribution <em>behavior(s)</em> and set <em>Forward Query Strings</em> to Yes.</p>

<p>When a visitor of the website requests the data <em>Amazon CloudFront</em> will use exactly the same url path and query strings
to fetch the content from the origin server. All that I had to do is switch the domain of the JSONP service
to point to the cloudfront.net domain. It became like this:</p>

<pre><code>                                                        | Everything on this side is handled by Amazon.
                                                        | No code required!
                                                        |
    monupco.com -- JSONP request --&gt; xyz.cloudfront.net -- JSONP request if cache miss --&gt; abc.rhcloud.com --v
        ^                              |                ^                                                    |
        |                              |                |                                                    |
    JavaScript processing              |                +---------- JSONP response --------------------------+
        |                              |
        +---- cached JSONP response ---+
</code></pre>

<p>As you can see the website structure and code didn&#8217;t change at all. All that changed was a single domain name.</p>

<h2>Controlling the cache</h2>

<p><em>Amazon CloudFront</em> will keep the contents in cache based on the origin headers if present or the manual configuration
from the AWS Console. To work around frequent requests to the origin server it is considered best practice to set the
Expires header to a value far in the future, like 1 year.
However if the content changes you need some way to tell <em>CloudFront</em> about it. The most commonly used method is through
using different URLs to access the same content. This will cause <em>CloudFront</em> to cache the content under the new location
while keeping the old content until it expires.</p>

<p><em>Dojo</em> makes this very easy:</p>

<pre><code>    require(["dojo/io/script"],
        function(script) {
                script.get({
                    url: "https://xyz.cloudfront.net/api/json/updates/1234",
                    callbackParamName: "callback",
                    content: {t: timeStamp},
                    load: function(jsonData) {
                        ....
                    },
    ....
</code></pre>

<p>The <em>content</em> property allows additional key/value pairs to be sent in the query string. The
<em>timeStamp</em> parameter serves only to control <em>Amazon CloudFront</em> cache. It&#8217;s not processed server side.</p>

<p>On the server-side we have:</p>

<pre><code>    response['Cache-Control'] = 'max-age=31536000'
    response['Expires'] = (datetime.now()+timedelta(seconds=31536000)).strftime('%a, %d %b %Y %H:%M:%S GMT')
</code></pre>

<h2>Benefits</h2>

<p>There were two immediate benefits:</p>

<ul>
<li>Reduced page load time. Combined with serving static files from CDN this greatly improves the user experience;</li>
<li>Reduced server load. Content is requested only once if it is missing from the cache and then served from CloudFront.
The server isn&#8217;t so busy serving content so it can be used to do more computations or simply reduce the bill.</li>
</ul>


<p>The presented method works well for <em>Monupco</em> because of two things:</p>

<ul>
<li>The content which <em>Monupco</em> serves usually doesn&#8217;t change at all once made public. In rare occasions, for example an error
has been published, we have to regenerate new content and publish it under the same URL.</li>
<li>Before content is made public it is inspected for errors and this also preseeds the cache.</li>
</ul>


<hr />

<p><a href="http://about.me/atodorov"><em>Alexander Todorov</em></a> is Monupco&#8217;s founder and lead developer!</p>

<p>For an insight of available updates to your open source components give
Monupco a <a href="https://monupco-otb.rhcloud.com/applications/mine/">try</a>!</p>
</div>
        
        
    

    

            
                
                    
        
            <h2><a href="/blog/2012/05/03/monupco-1.4-release-announcement/">Monupco 1.4 Release Announcement</a></h2>
        

        
            
  

<span class="byline author vcard">Posted by <span class="fn">Monupco Team</span></span>
@
            








  May 3<span>rd</span>, 2012



            <br /><br />
        
    

    
        <div class="entry-content"><p>Today <a href="http://monupco.com">Monupco</a> is pleased to announce version 1.4
of our updates monitoring service. Monupco provides user friendly interface to
available updates for your cloud applications and information about different
package versions.</p>

<p>This release adds support for <a href="http://rubygems.org/">RubyGems</a> and
new registration agents for <a href="http://dotcloud.com">dotCloud</a> and
<a href="http://openshift.redhat.com">OpenShift</a> Ruby applications. See
<a href="http://monupco.com/register/">how to register applications</a> page for more information.</p>

<p>There have been lots of bug fixes and improvements behind the scenes.
Since the <a href="/blog/blog/2012/04/02/monupco-1.3-release-announcement/">1.3 release</a>
we have significantly increased the number of updates processed by the service.
Currently new package versions are detected and published every day.
Monupco has already produced detailed information for 1600+
<a href="https://monupco-otb.rhcloud.com/updates/">updates</a>.</p>

<p>There were some changes to our web site to provide faster page load times:</p>

<ul>
<li>Static files are now served from <em>Amazon CloudFront</em>;</li>
<li>Individual update pages use <em>JSONP</em> to dynamically load the content.</li>
</ul>


<p><a href="https://monupco-otb.rhcloud.com/applications/mine/">Give it a try</a>
or <a href="https://twitter.com/monupco">follow us</a> on Twitter for more news.</p>
</div>
        
        
    

    

            
                
                    
        
            <h2><a href="/blog/2012/04/17/using-openshift-as-amazon-cloudfront-origin-server/">Using OpenShift as Amazon CloudFront Origin Server</a></h2>
        

        
            
  

<span class="byline author vcard">Posted by <span class="fn">Alexander Todorov</span></span>
@
            








  Apr 17<span>th</span>, 2012



            <br /><br />
        
    

    
        <div class="entry-content"><p>It&#8217;s been several months after the start of <a href="http://monupco.com"><em>Monupco</em></a> and we started
migrating various parts of the platform to CDN. The first to go are static 01 like
CSS, JavaScript, images and such. In this article I will show you how to get started with
<em>Amazon CloudFront</em> and <em>OpenShift</em>. It is very easy once you understand how it works.</p>

<h2>Why CloudFront and OpenShift</h2>

<p><em>Amazon CloudFront</em> is cheap and easy to setup with virtually no maintenance.
The most important feature 04 that it can fetch content from any public website.
Integrating it together with <em>OpenShift</em> gives some nice benefits:</p>

<ul>
<li>All static assets are managed with Git and stored in the same place where the application
code and HTML is - easy to develop and deploy;</li>
<li>No need for external service to host the static files;</li>
<li><em>CloudFront</em> will be serving the files so network load on <em>OpenShift</em> is minimal;</li>
<li>Easy to manage versioned URLs because HTML and static assets are in the same repo - more on this later;</li>
</ul>


<h2>Object expiration</h2>

<p><em>CloudFront</em> will cache your objects for a certain period and then expire them. Frequently
used objects are expired less often. Depending on the content you may want to update the cache
more or less frequently. In my case CSS and JavaScript files change rarely so I wanted to tell
CloudFront to not expire the files quickly. I did this by telling <em>Apache</em> to send a custom value for
the Expires header.</p>

<pre><code>    $ curl http://d71ktrt2emu2j.cloudfront.net/static/v1/css/style.css -D headers.txt
    $ cat headers.txt 
    HTTP/1.0 200 OK
    Date: Mon, 16 Apr 2012 19:02:16 GMT
    Server: Apache/2.2.15 (Red Hat)
    Last-Modified: Mon, 16 Apr 2012 19:00:33 GMT
    ETag: "120577-1b2d-4bdd06fc6f640"
    Accept-Ranges: bytes
    Content-Length: 6957
    Cache-Control: max-age=31536000
    Expires: Tue, 16 Apr 2013 19:02:16 GMT
    Content-Type: text/css
    Strict-Transport-Security: max-age=15768000, includeSubDomains
    Age: 73090
    X-Cache: Hit from cloudfront
    X-Amz-Cf-Id: X558vcEOsQkVQn5V9fbrWNTdo543v8VStxdb7LXIcUWAIbLKuIvp-w==,e8Dipk5FSNej3e0Y7c5ro-9mmn7OK8kWfbaRGwi1ww8ihwVzSab24A==
    Via: 1.0 d6343f267c91f2f0e78ef0a7d0b7921d.cloudfront.net (CloudFront)
    Connection: close
</code></pre>

<p>All headers before Strict-Transport-Security come from the origin server.</p>

<h2>Versioning</h2>

<p>Sometimes however you need to update the files and force <em>CloudFront</em> to update the content.
The recommended way to do this is to use URL versioning and update the path to the files
which changed. This will force <em>CloudFront</em> to cache and serve the content under the new path
while keeping the old content available until it expires. This way your visitors will not be
viewing your site with the new CSS and old JavaScript.</p>

<p>There are many ways to do this and there are some nice frameworks as well. For Python there is <em>webassets</em>.
I don&#8217;t have many static files so I opted for no additional dependencies. Instead I will be updating the
versions by hand.</p>

<p>What comes to mind is using <em>mod_rewrite</em> to redirect the versioned URLs back to non versioned ones.
However there&#8217;s a catch. If you do this <em>CloudFront</em> will cache the redirect itself, not the content.
The next time visitors hit <em>CloudFront</em> they will receive the cached redirect and follow it back to your
origin server, which is defeating the purpose of having CDN.</p>

<p>To do it properly you have to rewrite the URLs but still return a 200 response code and the
content which needs to be cached. This is done with <em>mod_proxy</em>:</p>

<pre><code>    RewriteEngine on
    RewriteRule ^VERSION-(\d+)/(.*)$ http://%{ENV:OPENSHIFT_INTERNAL_IP}:%{ENV:OPENSHIFT_INTERNAL_PORT}/static/$2 [P,L]
</code></pre>

<p>This .htaccess trick doesn&#8217;t work on <em>OpenShift</em> though. <em>mod_proxy</em> is not enabled at the moment.
See <a href="https://bugzilla.redhat.com/show_bug.cgi?id=812389">bug 812389</a> for more info.</p>

<p>Luckily I was able to use symlinks to point to the content. Here&#8217;s how it looks:</p>

<pre><code>    $ pwd
    /home/atodorov/monupco/wsgi/static

    $ cat .htaccess
    ExpiresActive On
    ExpiresDefault "access plus 1 year"

    $ ls -l
    drwxrwxr-x. 6 atodorov atodorov 4096 16 Apr 21,31 o
    lrwxrwxrwx. 1 atodorov atodorov    1 16 Apr 21,47 v1 -&gt; o

    settings.py:
    STATIC_URL = '//d71ktrt2emu2j.cloudfront.net/static/v1/'

    HTML template:
    &lt;link type="text/css" rel="stylesheet" media="screen" href="{{ STATIC_URL }}css/style.css" /&gt;
</code></pre>

<h2>How to implement it</h2>

<p>First you need to split all CSS and JavaScript from your HTML if you haven&#8217;t done so already.</p>

<p>Then place everything under your git repo so that <em>OpenShift</em> will serve the files. For Python applications
place the files under wsgi/static/ directory in your git repo.</p>

<p>Point all of your HTML templates to the static location on <em>OpenShift</em> and test if everything works as expected.
This is best done if you&#8217;re using some sort of template language and store the location
in a single variable which you can change later.
<em>Monupco</em> uses <em>Django</em> and the <em>STATIC_URL</em> variable of course.</p>

<p>Create your <em>CloudFront</em> distribution - don&#8217;t use <em>Amazon S3</em>, instead configure a custom origin server. Write down
your <em>CloudFront</em> URL. It will be something like <strong>1234xyz.cludfront.net</strong>.</p>

<p>Every time a request hits <em>CloudFront</em> it will check if the object is present in the cache. If not present
<em>CloudFront</em> will fetch the object from the origin server and populate the cache. Then the object is sent
to the user.</p>

<p>Update your templates to point to the new cloudfront.net URL and redeploy your website!</p>

<hr />

<p><a href="http://about.me/atodorov"><em>Alexander Todorov</em></a> is Monupco&#8217;s founder and lead developer!</p>

<p>For an insight of available updates to you OpenShift applications give
Monupco a <a href="https://monupco-otb.rhcloud.com/applications/mine/">try</a>!</p>
</div>
        
        
    

    

            
                
                    
        
            <h2><a href="/blog/2012/04/02/monupco-1.3-release-announcement/">Monupco 1.3 Release Announcement</a></h2>
        

        
            
  

<span class="byline author vcard">Posted by <span class="fn">Monupco Team</span></span>
@
            








  Apr 2<span>nd</span>, 2012



            <br /><br />
        
    

    
        <div class="entry-content"><p>Today <a href="http://monupco.com">Monupco</a> is pleased to announce version 1.3
of our updates monitoring service. Monupco provides user friendly interface to
monitor available updates for your cloud applications and information about different
package versions.</p>

<p>This release adds support for Perl packages from <a href="http://search.cpan.org/">CPAN</a>.
Request Tracker issue tracking systems on <a href="http://rt.cpan.org">http://rt.cpan.org</a> and <a href="http://rt.perl.org">http://rt.perl.org</a>
are also supported.</p>

<p>Perl support comes with registration agents for <a href="http://dotcloud.com">dotCloud</a> and
<a href="http://openshift.redhat.com">OpenShift</a>. See the
<a href="http://monupco.com/register/">how to register applications</a> page for more information.</p>

<p>Our web interface faced some changes too:</p>

<ul>
<li>Details about changes is no longer processed as Markdown. It is presented as
pre-formatted plain text. This is to prevent some characters (like underscores) getting
lost due to Markdown conversion;</li>
<li>Update pages now integrate with <a href="http://disqus.com">Disqus</a>. You can use the comments form
to provide general feedback and comments and to alert our team in case the information
is incorrect.</li>
</ul>


<p>Monupco has already produced detailed information for 950+ <a href="https://monupco-otb.rhcloud.com/updates/">updates</a>.</p>

<p><a href="https://monupco-otb.rhcloud.com/applications/mine/" class="button dark_blue small">Give It A Try</a>
or <a href="https://twitter.com/monupco">follow us</a> on Twitter for more news.</p>
</div>
        
        
    

    

            
                
                    
        
            <h2><a href="/blog/2012/03/14/openshift-cron-takes-over-celerybeat/">OpenShift Cron Takes Over Celerybeat</a></h2>
        

        
            
  

<span class="byline author vcard">Posted by <span class="fn">Alexander Todorov</span></span>
@
            








  Mar 14<span>th</span>, 2012



            <br /><br />
        
    

    
        <div class="entry-content"><p><a href="http://celeryproject.org/"><em>Celery</em></a> is an asynchronous task queue/job queue
based on distributed message passing. You can define tasks as Python functions,
execute them in the background and in a periodic fashion.
<a href="http://monupco.com"><em>Monupco</em></a> uses <em>Celery</em> for virtually everything.
Some of the tasks are scheduled after some event takes place (like user pressed a button)
or scheduled periodically.</p>

<p><em>Celery</em> provides several components of which <em>celerybeat</em> is the periodic task scheduler.
When combined with <a href="http://djangoproject.com"><em>Django</em></a> it gives you a very nice admin interface
which allows periodic tasks to be added to the scheduler.</p>

<h2>Why change</h2>

<p><em>Monupco</em> has relied on <em>celerybeat</em> for a couple of months. Back then, when <em>Monupco</em> launched,
there was no cron support for OpenShift so running <em>celerybeat</em> sounded reasonable.
It used to run on a dedicated virtual server and for most of the time that was fine.</p>

<p>There were a number of issues which <em>Monupco</em> faced during its first months:</p>

<ul>
<li><p><em>celerybeat</em> would sometime die due to no free memory on the virtual instance.
When that happened no new tasks were scheduled and data was left unprocessed.
Let alone that higher memory instance and the processing power which comes with it
cost extra money.</p></li>
<li><p><em>Monupco</em> is split into several components which need to have the same code base
locally - the most important are database settings and the periodic tasks
code. At least in one occasion <em>celerybeat</em> failed to start because of a buggy
task code. The offending code was fixed in the application server on OpenShift but
not properly synced to the <em>celerybeat</em> instance. Keeping code in sync is a priority
for distributed projects which rely on <em>Celery</em>.</p></li>
<li><p><em>Celery</em> and <em>django-celery</em> seem to be updated quite often. This poses a significant risk
of ending up with different versions on the scheduler, worker nodes and the app server. This will
bring the whole application to a halt if at some point a backward incompatible change is introduced
and not properly tested and updated. Keeping infrastructure components in sync can be a big challenge
and I try to minimize this effort as much as possible.</p></li>
<li><p>Having to navigate to the admin pages every time I add a new task or want to change the execution
frequency doesn&#8217;t feel very natural for a console user like myself and IMHO is less productive.
For the record I primarily use <em>mcedit</em>. I wanted to have something more close to the
write, commit and push work-flow.</p></li>
</ul>


<h2>The take over</h2>

<p>It&#8217;s been some time since OpenShift
<a href="https://www.redhat.com/openshift/community/blogs/getting-started-with-cron-jobs-on-openshift">introduced</a>
the cron cartridge and I decided to give it a try.</p>

<p>The first thing I did is to write a simple script which can execute any task from the monupco.tasks module
by piping it to the Django shell (a Python shell actually).</p>

<pre><code>$ cat run_celery_task 

#!/bin/bash
#
# Copyright (c) 2012, Alexander Todorov &lt;atodorov@nospam.otb.bg&gt;
#
# This script is symlinked to from the hourly/minutely, etc. directories
#
# SYNOPSIS
#
# ./run_celery_task cron_search_dates
#
# OR
#
# ln -s run_celery_task cron_search_dates
# ./cron_search_dates
#

TASK_NAME=$1
[ -z "$TASK_NAME" ] &amp;&amp; TASK_NAME=$(basename $0)

if [ -n "$OPENSHIFT_APP_DIR" ]; then
    source $OPENSHIFT_APP_DIR/virtenv/bin/activate
    export PYTHON_EGG_CACHE=$OPENSHIFT_DATA_DIR/.python-eggs
    REPO_DIR=$OPENSHIFT_REPO_DIR
else
    REPO_DIR=$(dirname $0)"/../../.."
fi

echo "import monupco.tasks; monupco.tasks.$TASK_NAME.delay()" | $REPO_DIR/wsgi/monupco/manage.py shell
</code></pre>

<p>This is a multicall script which allows symlinks with different names to point to it.
Thus to add a new task to cron I just need to make a symlink to the script from one of the
hourly, minutely, daily, etc. directories under cron/</p>

<p>The script accepts a parameter as well which allows me to execute it locally for debugging purposes
or to schedule some tasks out of band.</p>

<p>This is how it looks like on the file system:</p>

<pre><code>$ ls -l .openshift/cron/hourly/
some_task_name -&gt; ../tasks/run_celery_task
another_task -&gt; ../tasks/run_celery_task
</code></pre>

<p>After having done these preparations I only had to embed the cron cartridge and git push to OpenShift:</p>

<pre><code>rhc-ctl-app -a monupco -e add-cron-1.4 &amp;&amp; git push
</code></pre>

<h2>What&#8217;s next</h2>

<p>At present OpenShift can schedule your jobs every minute, hour, day, week or month and does so using the
<em>run-parts</em> script. You can&#8217;t schedule a script to execute at 4:30 every Monday or every 45 minutes for example.
See <a href="https://bugzilla.redhat.com/show_bug.cgi?id=803485">rhbz #803485</a> if you want to follow the
progress. Luckily <em>Monupco</em> doesn&#8217;t use this sort of job scheduling for the moment.</p>

<p><em>Monupco</em> is scheduling periodic tasks from OpenShift cron for a few days already.
It seems to work reliably and with no issues. One less component to maintain and worry about.
More time to write code.</p>

<hr />

<p><a href="http://about.me/atodorov"><em>Alexander Todorov</em></a> is Monupco&#8217;s founder and lead developer!</p>

<p>For an insight of available updates to you OpenShift applications give
Monupco a <a href="https://monupco-otb.rhcloud.com/applications/mine/">try</a>!</p>
</div>
        
        
    

    

            
                
                    
        
            <h2><a href="/blog/2012/03/09/how-to-get-to-the-openshift-shell/">How to Get to the OpenShift Shell</a></h2>
        

        
            
  

<span class="byline author vcard">Posted by <span class="fn">Alexander Todorov</span></span>
@
            








  Mar 9<span>th</span>, 2012



            <br /><br />
        
    

    
        <div class="entry-content"><p>I wanted to examine the Perl environment on OpenShift and got tired of making snapshots,
unzipping the archive and poking through the files. I wanted a shell. Here&#8217;s how to get one.</p>

<ol>
<li><p>Get the application info first</p>

<pre><code> $ rhc-domain-info 
 Password: 
 Application Info
 ================
 myapp
     Framework: perl-5.10
      Creation: 2012-03-08T13:34:46-04:00
          UUID: 8946b976ad284cf5b2401caf736186bd
       Git URL: ssh://8946b976ad284cf5b2401caf736186bd@myapp-mydomain.rhcloud.com/~/git/myapp.git/
    Public URL: http://myapp-mydomain.rhcloud.com/

  Embedded: 
       None
</code></pre></li>
<li><p>The Git URL has your username and host</p></li>
<li><p>Now just ssh into the application</p>

<pre><code> $ ssh 8946b976ad284cf5b2401caf736186bd@myapp-mydomain.rhcloud.com

     Welcome to OpenShift shell

     This shell will assist you in managing OpenShift applications.

     !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!
     Shell access is quite powerful and it is possible for you to
     accidentally damage your application.  Proceed with care!
     If worse comes to worst, destroy your application with 'rhc app destroy'
     and recreate it
     !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!

     Type "help" for more info.

 [myapp-mydomain.rhcloud.com ~]\&gt; 
</code></pre></li>
</ol>


<p><strong>Voila!</strong></p>

<hr />

<p><a href="http://about.me/atodorov"><em>Alexander Todorov</em></a> is Monupco&#8217;s founder and lead developer!</p>

<p>For an insight of available updates to you OpenShift applications give
Monupco a <a href="https://monupco-otb.rhcloud.com/applications/mine/">try</a>!</p>
</div>
        
        
    

    

            
                
                    
        
            <h2><a href="/blog/2012/02/18/how-to-update-dependencies-on-openshift/">How to Update Dependencies on OpenShift</a></h2>
        

        
            
  

<span class="byline author vcard">Posted by <span class="fn">Alexander Todorov</span></span>
@
            








  Feb 18<span>th</span>, 2012



            <br /><br />
        
    

    
        <div class="entry-content"><p>If you are already running some cool application on <a href="http://openshift.redhat.com">OpenShift</a>
it could be the case that you have to update some of the packages installed as dependencies.
Here is an example for an application using the python-2.6 cartridge.</p>

<h2>Pull latest upstream packages</h2>

<p>The most simple method is to update everything to the latest upstream versions.</p>

<ol>
<li><p>Backup! Backup! Backup!</p>

<pre><code> rhc-snapshot -a mycoolapp
 mv mycoolapp.tar.gz mycoolapp-backup-before-update.tar.gz
</code></pre></li>
<li><p>If you haven&#8217;t specified any particular version in <code>setup.py</code> it will
look like this:</p>

<pre><code>  ...
  install_requires=[
                  'monupco-openshift-express-python',
                  'MySQL-python',
                  'Markdown',
                 ],
  ...
</code></pre></li>
<li><p>To update simply push to OpenShift instructing it to rebuild your virtualenv:</p>

<pre><code> cd mycoolapp/
 touch .openshift/markers/force_clean_build
 git add .openshift/markers/force_clean_build
 git commit -m "update to latest upstream"
 git push
</code></pre></li>
</ol>


<p>Voila! The environment hosting your application is rebuilt from scratch.</p>

<h2>Keeping some packages unchanged</h2>

<p>Suppose that before the update you have <code>Markdown-2.0.1</code> and you want to keep it!
This is easily solved by adding versioned dependency to <code>setup.py</code></p>

<pre><code>    -       'Markdown',
    +       'Markdown==2.0.1',
</code></pre>

<p>If you do that OpenShift will install the same <code>Markdown</code> version when rebuilding your
application. Everything else will use the latest available versions.</p>

<p><strong>Note:</strong> after the update it&#8217;s recommended that you remove the
<code>.openshift/markers/force_clean_build</code> file. This will speed up the push/build process
and will not surprise you with unwanted changes.</p>

<h2>Update only selected packages</h2>

<p>Unless your application is really simple or you have tested the updates, I suspect that
you want to update only selected packages. This can be done without rebuilding the whole
virtualenv. Use versioned dependencies in <code>setup.py</code> :</p>

<pre><code>    -       'Markdown==2.0.1',
    -       'django-countries',
    +       'Markdown&gt;=2.1',
    +       'django-countries&gt;=1.1.2',
</code></pre>

<p>No need for <code>force_clean_build</code> this time. Just</p>

<pre><code>    git commit &amp;&amp; git push
</code></pre>

<p>At the time of writing my application was using <code>Markdown-2.0.1</code> and <code>django-countries-1.0.5</code>.
Then it updated to <code>Markdown-2.1.1</code> and <code>django-countires-1.1.2</code> which also happened to be
the latest versions.</p>

<p><strong>Note:</strong> this will not work without <code>force_clean_build</code></p>

<pre><code>    -       'django-countries==1.0.5',
    +       'django-countries',
</code></pre>

<h2>Warning</h2>

<p>OpenShift uses a local mirror of <a href="http://pypi.python.org">Python Package Index</a>.
It seems to be updated every 24 hours or so. Have this in mind if you want to update
to a package that was just released. It will not work!</p>

<hr />

<p><a href="http://about.me/atodorov"><em>Alexander Todorov</em></a> is Monupco&#8217;s founder and lead developer!</p>

<p>For an insight of available updates to you OpenShift applications give
Monupco a <a href="https://monupco-otb.rhcloud.com/applications/mine/">try</a>!
It keeps generating new <a href="http://monupco.com/advisories/">advisories</a> every day!</p>
</div>
        
        
    

    

            
                
                    
        
            <h2><a href="/blog/2012/02/17/monupco-1.2-release-announcement/">Monupco 1.2 Release Announcement</a></h2>
        

        
            
  

<span class="byline author vcard">Posted by <span class="fn">Monupco Team</span></span>
@
            








  Feb 17<span>th</span>, 2012



            <br /><br />
        
    

    
        <div class="entry-content"><p>Today <a href="http://monupco.com">Monupco</a> is pleased to announce version 1.2
of our updates monitoring service. Monupco provides user friendly interface to
monitor available updates for your cloud applications and information about different
package versions.</p>

<p>This release adds support for <a href="http://npmjs.org">NodeJS</a> packages. We&#8217;ve
aready imported 1000 of the most dependent upon packages and started to process updates.
Monupco has already produced detailed information for 60+ <a href="http://monupco.com/advisories/">advisories</a>.</p>

<p>Client side registration tool for NodeJS applications hosted at <a href="http://dotcloud.com">dotCloud</a> has
been added as well. It is contributed and maintained by <a href="http://github.com/zaro">Svetlozar Argirov</a>.
For more information see the <a href="http://monupco.com/install">install</a> page.</p>

<p>Small improvements to the web interface were made:</p>

<ul>
<li>Added pagination to the advisories and application details pages;</li>
<li>Added buttons to show only packages which need updates in application details page;</li>
<li>Added buttons to filter applications by status.</li>
</ul>


<p>In the next weeks we&#8217;re looking to enable support for Ruby, PHP, Perl and Java and extend
client side tools to more vendors. Stay <a href="https://twitter.com/monupco">tuned</a> if you don&#8217;t
want to miss the announcement.</p>

<p><a href="https://monupco-otb.rhcloud.com/applications/mine/" class="button dark_blue small">Give It A Try Now</a></p>
</div>
        
        
    

    

            
                
                    
        
            <h2><a href="/blog/2012/02/11/how-to-write-registration-agent-for-monupco/">How to Write a Registration Agent for Monupco</a></h2>
        

        
            
  

<span class="byline author vcard">Posted by <span class="fn">Monupco Team</span></span>
@
            








  Feb 11<span>th</span>, 2012



            <br /><br />
        
    

    
        <div class="entry-content"><p><a href="http://monupco.com">Monupco</a> is aiming to support a broad range of PaaS and
cloud vendors but that takes time. If your favorite PaaS platform is not
already supported here&#8217;s how you can help.</p>

<p>The registration agent is very simple and serves only a single purpose -
to build a list of installed software and send it to the server.</p>

<p>Some general considerations first:</p>

<ul>
<li><p>Your code should be open source! Preferably licensed under the MIT or BSD license;</p></li>
<li><p>Whenever possible use the native programming language for the platform - if writing
an agent for PHP PaaS use PHP, if writing for Node.JS use JavaScript, etc;</p></li>
<li><p>All registration agents are bundled as packages so that they can install natively
on the platform. For Python it is a package from PyPI, for PHP it will be a PEAR package,
etc. Develop your agent as a package;</p></li>
<li><p>Naming convention for registration agent is <strong>monupco-&lt;vendor>-&lt;language></strong>. For example
<code>monupco-openshift-express-python</code>, <code>monupco-dotcloud-nodejs</code>. If you have common code,
for example the package management part, it can be split into separate module named
<strong>common-&lt;language>-monupco</strong>.</p></li>
<li><p>Registration agents are specific to vendor and programming language. This is because
different PaaS vendors provide the information in a different way. This makes code easier
to maintain and easier for end-users to find the proper registration agent later;</p></li>
<li><p>Vendor ID and package type ID numbers are unique. It is important to use the correct IDs.
They allow proper identification of applications and packages stored in the database.
Different types of data also require different processing. Tell us for which vendor/language
you would like to contribute a registration agent and we will reserve the IDs for you;</p></li>
<li><p>We will also setup a development server so you can safely test the application
registration/update process. Just let us know you need one.</p></li>
</ul>


<p>Once you have the ID allocation and development server you can start writing some code.</p>

<ul>
<li><p>Your code should create the following data structure:</p>

<pre><code>  {
      'user_id'    : integer,
      'app_name'   : string,
      'app_uuid'   : string,
      'app_type'   : string,
      'app_url'    : string,
      'app_vendor' : integer,
      'pkg_type'   : integer,
      'installed'  : list of {'n' : string, 'v' : string, 't' : integer}
  }
</code></pre></li>
</ul>


<p>Fields are defined as follow:</p>

<ul>
<li><p>user_id - integer - the ID of the user at Monupco website. All applications registered under
the same user_id will be visible only to that user. You can view your UserID
<a href="https://monupco-otb.rhcloud.com/profiles/mine/">here</a>. It is important that this value is not
hard-coded but read from ENV variable or a text file. The user will configure the proper
value when installing the registration agent into their application;</p></li>
<li><p>app_name - string - the name of the application. This is used to identify the application in the
web interface. The value is usually available from ENV variable;</p></li>
<li><p>app_uuid - string - a unique identifier of the application on the cloud platform. Some platforms
do not provide a real UUID. In such case you may use any unique string, for example $username-$appname;</p></li>
<li><p>app_type - string - type of the application, e.g. Python, Ruby, etc. Used for visualization in the
web interface. Some cloud vendors store this in ENV variable;</p></li>
<li><p>app_url - string - the URL at which the application can be accessed including the protocol part (http://).
Should be available from ENV;</p></li>
<li><p>app_vendor - integer - the vendor ID reserved by Monupco. This is used for proper identification
of applications in the web console and for processing purposes;</p></li>
<li><p>pkg_type - integer - the package type ID reserved by Monupco. This is used to properly process
package information and find new versions and updates. If the cloud platform allows only a single
type of packages to be installed into the application then use this variable. If you can install
multiple package types (e.g. Python and Ruby) then you can set this on a per-package basis;</p></li>
<li><p>installed - a list of {&#8216;n&#8217; : string, &#8216;v&#8217; : string, &#8216;t&#8217; : integer} elements, where:</p>

<ul>
<li><p>n - string - package name as identified by a native package management tool (e.g. gem, pip, etc);</p></li>
<li><p>v - string - package version;</p></li>
<li><p>t - integer (optional) - package type ID reserved by Monupco. Define it here is multiple
package types are allowed and the current package is different from <code>pkg_type</code>.</p></li>
</ul>
</li>
<li><p>In some cloud platforms your application will be considered as a package and listed in the database
as well. You may use an ENV variable to ignore this name and not include it in the list;</p></li>
<li><p>The defined structure is converted into JSON format and URL escaped;</p></li>
<li><p>Assign the escaped JSON string to the <code>json_data</code> POST variable;</p></li>
<li><p>Send a POST request to https://$devel-server-url/application/register/;</p></li>
<li><p>When sending the request make sure to include a <code>User-agent</code> header. The <code>User-agent</code>
string must follow the format:</p>

<pre><code>  monupco-&lt;vendor&gt;-&lt;language&gt;/&lt;version&gt;
</code></pre></li>
<li><p>If using common packages include them in the <code>User-agent</code> string as follows:</p>

<pre><code>  monupco-&lt;vendor&gt;-&lt;language&gt;/&lt;version&gt; common-&lt;language&gt;-monupco/&lt;version&gt;
</code></pre>

<p>For more information about <code>User-aget</code> string format click
<a href="http://en.wikipedia.org/wiki/User_agent#Format">here</a>.</p></li>
<li><p>If everything went fine you will receive a 200 status code and response in JSON format:</p>

<pre><code>  {
      'message' : string,
      'exit_code' : integer
  }
</code></pre>

<ul>
<li><p>message - holds any pass/fail messages;</p></li>
<li><p>exit_code - non 0 in case of failure.</p></li>
</ul>
</li>
<li><p>Add a README file with instructions how to install. Pay attention to end-user configuration
settings and proper execution of the tool. The best place to place a call to
the registration script is a post_deploy/post_install hook. Some cloud platforms do not offer
hooks. In this case you may want to ping us for some help.</p></li>
</ul>


<p>Congratulations! You have just written a registration agent for your favorite PaaS and
programming language. Sent us the code for review and we will add it to our GitHub channel.</p>

<p>For more details you may take a look at <a href="https://github.com/monupco/monupco-openshift-express-python">https://github.com/monupco/monupco-openshift-express-python</a>.</p>
</div>
        
        
    

    

            

        <div id="paging">
            
                <a class="prev" href="/blog/page/2/">&larr; Older</a>
            
            <a href="/blog/archives">Blog Archives</a>
            
        </div>


            </div>
        </div>

    </div> <!-- END FRONTPAGE -->

      <div id="footer">
        <div class="toplevel">
            <ul>
                <li><a href="http://monupco.com/features/">Features</a></li>
                <li><a href="http://monupco.com/register/">Register Apps</a></li>
                <li><a href="http://monupco.com/about/">About</a></li>
                <li><a href="mailto:info[at]monupco.com">Contact</a></li>
                <li><a href="http://twitter.com/monupco">@monupco</a></li>
                <li><a href="https://github.com/monupco/monupco.github.com/issues/new">Report bug</a></li>
            </ul>
            <div style="float: right;">&copy; 2011-2012 monupco</div>
        </div>
    </div>


  
<div id="fb-root"></div>
<script type="text/javascript">(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<script type="text/javascript">
      var disqus_shortname = 'monupco';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




</body>
</html>
